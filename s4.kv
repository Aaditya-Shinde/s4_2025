#:import Factory kivy.factory.Factory

WindowManager:
    Diagnosis:
    About:
    CameraScreen:
        
<About>:
    name: "About"
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size 
    GridLayout:
        cols: 1
        rows: 2
        size: root.width, root.height

        ActionBar:
            background_color: (0.14, 0.68, 0.87, 1)
            background_image: ''

            ActionView:
                use_separator: True

                ActionPrevious:
                    title: 'DiagnoSys'
                    with_previous: False

                ActionButton:
                    text: "Home"
                    on_press: app.root.current = "Diagnosis"

                ActionButton:
                    text: "About"
                    on_press: app.root.current = "About"

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                padding: 24
                spacing: 20
                GridLayout:
                    cols: 1
                    size_hint_y: None
                    height: self.minimum_height
                    padding: 24
                    spacing: 20

                    Label:
                        color: 0, 0, 0, 1
                        text: "[b]Aaditya Shinde[/b]"
                        markup: True
                        font_size: '26sp'
                        size_hint_y: None
                        halign: 'center'

                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint_y: None
                        height: self.minimum_height
                        padding: 24
                        spacing: 20
                        canvas.before:
                            Color:
                                rgba: 1, 1, 1, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [16]

                        Label:
                            color: 0, 0, 0, 1
                            text: "I'm a rising freshman going into Homestead Highschool. I'm excited to participate in S4 and help people in our community through DiagnoSys."
                            font_size: '16sp'
                            size_hint_y: None
                            height: self.texture_size[1]
                            halign: 'left'
                            valign: 'top'
                            text_size: self.width, None

                        CircularImage:
                            source: "person1.png"
                            size: 200, 200
                GridLayout:
                    cols: 1
                    size_hint_y: None
                    height: self.minimum_height
                    padding: 24
                    spacing: 20

                    Label:
                        color: 0, 0, 0, 1
                        text: "[b]Arjun Surendra[/b]"
                        markup: True
                        font_size: '26sp'
                        size_hint_y: None
                        halign: 'center'

                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint_y: None
                        height: self.minimum_height
                        padding: 24
                        spacing: 20
                        canvas.before:
                            Color:
                                rgba: 1, 1, 1, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [16]

                        Label:
                            color: 0, 0, 0, 1
                            text: "Hello, I'm Arjun Surendra. I am a rising freshman at Homestead High School. I live in Sunnyvale, and I am very excited to help our people with DiagnoSys!"
                            font_size: '16sp'
                            size_hint_y: None
                            height: self.texture_size[1]
                            halign: 'left'
                            valign: 'top'
                            text_size: self.width, None

                        CircularImage:
                            source: "person2.png"
                            size: 200, 200
                GridLayout:
                    cols: 1
                    size_hint_y: None
                    height: self.minimum_height
                    padding: 24
                    spacing: 20

                    Label:
                        color: 0, 0, 0, 1
                        text: "[b]Raghav Joshi[/b]"
                        markup: True
                        font_size: '26sp'
                        size_hint_y: None
                        halign: 'center'

                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint_y: None
                        height: self.minimum_height
                        padding: 24
                        spacing: 20
                        canvas.before:
                            Color:
                                rgba: 1, 1, 1, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [16]

                        Label:
                            color: 0, 0, 0, 1
                            text: "Hi, Iâ€™m Raghav Joshi, a rising freshman entering Fremont High School next year. I am intrigued by the power of AI in improving healthcare and am excited to participate in the Cupertino Library S4 contest to help our community with DiagnoSys."
                            font_size: '16sp'
                            size_hint_y: None
                            height: self.texture_size[1]
                            halign: 'left'
                            valign: 'top'
                            text_size: self.width, None

                        CircularImage:
                            source: "person3.png"
                            size: 200, 200

<HelpPopup@Popup>:
    auto_dismiss: False
    title: "Choose a hospital"
    size_hint: 0.6, 0.2
    pos_hint:{"x":0.2, "top":0.9}
    BoxLayout:
        orientation: 'vertical'
        Button:
            text: 'El Camino Health'
            on_release: root.dismiss()
            on_release: app.root.get_screen("Diagnosis").get_help("El Camino Health")
        Button:
            text: 'Valley Medical'
            on_release: root.dismiss()
            on_release: app.root.get_screen("Diagnosis").get_help("Valley Medical")

<Diagnosis>:
    name: "Diagnosis"
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: [0, 0, 0, 0] 
        spacing: 10           

        ActionBar:
            size_hint_y: None
            height: '48dp'  
            background_color: (0.14, 0.68, 0.87, 1)
            background_image: ''

            ActionView:
                use_separator: True

                ActionPrevious:
                    title: 'DiagnoSys'
                    with_previous: False

                ActionButton:
                    text: "Home"
                    on_press: app.root.current = "Diagnosis"

                ActionButton:
                    text: "About"
                    on_press: app.root.current = "About"

        Label:
            text: 'DiagnoSys'
            color: 0, 0, 0, 1
            size_hint_y: None
            height: self.texture_size[1] + 10
            halign: 'center'
            valign: 'middle'
            text_size: self.width, None

        ScrollView:
            size_hint_y: 1
            do_scroll_x: False
            do_scroll_y: True

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                padding: 10
                spacing: 10

                Label:
                    id: response
                    text: ""
                    padding: 5, 0, 5, 0
                    size_hint_y: None
                    height: self.texture_size[1]
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'top'
                    markup: True

        BoxLayout:
            size_hint_y: None
            height: '60dp'
            orientation: 'horizontal'
            padding: [5, 0, 5, 0]
            spacing: 10

            Button:
                background_normal: ''
                background_down: ''
                size_hint: None, None
                size: 60, 60
                on_press:
                    self.background_color = (0.7, 0.7, 0.7, 1)
                on_release:
                    self.background_color = (0, 0, 0, 0)
                    app.root.current = "Camera"
                Image:
                    source: 'camera.png'
                    size_hint: None, None
                    size: 50, 50
                    center_x: self.parent.center_x
                    center_y: self.parent.center_y

            Button:
                background_normal: ''
                background_down: ''
                size_hint: None, None
                size: 60, 60
                on_press:
                    self.background_color = (0.7, 0.7, 0.7, 1)
                on_release:
                    self.background_color = (0, 0, 0, 0)
                    Factory.HelpPopup().open()
                Image:
                    source: 'doctor.png'
                    size_hint: None, None
                    size: 50, 50
                    center_x: self.parent.center_x
                    center_y: self.parent.center_y

            Button:
                background_normal: ''
                background_down: ''
                size_hint: None, None
                size: 60, 60
                on_press:
                    self.background_color = (0.7, 0.7, 0.7, 1)
                on_release:
                    self.background_color = (0, 0, 0, 0)
                Image:
                    source: 'call.png'
                    size_hint: None, None
                    size: 50, 50
                    center_x: self.parent.center_x
                    center_y: self.parent.center_y

        TextInput:
            id: prompt
            size_hint_y: None
            height: '70dp'
            padding: 20
            hint_text: "Type symptoms here"
            multiline: False
            on_text_validate: root.text_inquiry()


<CameraScreen>
    name: "Camera"
    Camera:
        id:camera
        play:True
        index: 0
        size_hint: 1, 1
        Button:
            on_press: app.root.current = "Diagnosis"
            on_press: root.save_image()
            text: 'Capture'
            center_x: self.parent.center_x
            size: 150, 150



<CircularImage@Widget>:
    source: None
    canvas:
        StencilPush
        Ellipse:
            pos: self.pos
        StencilUse
        Rectangle:
            pos: self.pos
            source: root.source
        StencilUnUse
        StencilPop
